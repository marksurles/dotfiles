#!/usr/bin/env sh
# POSIX-safe dotfiles installer (aliases only)

# Use current directory as the dotfiles repo root (GitHub runs this from repo root)
DOTFILES_DIR="${DOTFILES_DIR:-$PWD}"
LOG="$HOME/.dotfiles_install.log"

# Make sure ~/.bashrc exists and sources ~/.bash_aliases
[ -f "$HOME/.bashrc" ] || : > "$HOME/.bashrc"
# Append once, idempotent guard
grep -q 'DOTFILES_ALIASES' "$HOME/.bashrc" 2>/dev/null || {
  {
    echo '# DOTFILES_ALIASES'
    echo '[ -f "$HOME/.bash_aliases" ] && . "$HOME/.bash_aliases"'
  } >> "$HOME/.bashrc"
}

# Link aliases (only if it exists in the repo)
if [ -f "$DOTFILES_DIR/.bash_aliases" ]; then
  ln -sfn "$DOTFILES_DIR/.bash_aliases" "$HOME/.bash_aliases" 2>/dev/null || true
  echo "linked: $HOME/.bash_aliases -> $DOTFILES_DIR/.bash_aliases" >> "$LOG"
else
  echo "warning: $DOTFILES_DIR/.bash_aliases not found" >> "$LOG"
fi

# Quiet success marker
echo "install done: $(date)" >> "$LOG"
